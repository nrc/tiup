# Benchmarking

To facilitate this, TiUP has integrated the bench component, which currently provides two workloads for pressure testing: tpcc and tpch, with the following command parameters:

```bash
[root@localhost ~]# tiup bench
Starting component `bench`: /Users/joshua/.tiup/components/bench/v0.0.1/bench 
Benchmark database with different workloads

Usage:
  tiup bench [command]

Available Commands:
  help        帮助信息
  tpcc        以 TPC-C 作为 workload 压测
  tpch        以 TPC-H 作为 workload 压测

Flags:
      --count int           总执行次数, 0 表示无限次
  -D, --db string           被压测数据库名称 (默认为 "test")
  -d, --driver string       数据库驱动: mysql
      --dropdata            在 prepare 之前清除历史数据
  -h, --help                bench 命令自身的帮助信息
  -H, --host string         数据库的主机地址 (默认 "127.0.0.1")
      --ignore-error        忽略压测时数据库报出的错误
      --interval duration   两次报告输出时间的间隔 (默认 10s)
      --isolation int       隔离级别 0: Default, 1: ReadUncommitted, 
                            2: ReadCommitted, 3: WriteCommitted, 4: RepeatableRead, 
                            5: Snapshot, 6: Serializable, 7: Linerizable
      --max-procs int       runtime.GOMAXPROCS
  -p, --password string     数据库密码
  -P, --port int            数据库端口 (默认 4000)
      --pprof string        pprof 地址
      --silence             压测过程中不打印错误信息
      --summary             只打印 Summary
  -T, --threads int         压测并发线程数 (默认 16)
      --time duration       总执行时长 (默认 2562047h47m16.854775807s)
  -U, --user string         压测时使用的数据库用户 (默认 "root")
```

## TPC-C

The commands and parameters of TPC-C are as follows:

```bash
Available Commands:
  check       check for data consistency
  cleanup     clear data
  prepare     prepare data
  run         run benchmark

Flags:
      --check-all        run all consistency checks
  -h, --help             tpcc help information
      --output string    directory where csv file is generated when data is prepared
      --parts int        number of partition repositories (default 1)
      --tables string    specifies the tables used to generate the file, multiple tables can be split, only valid if output is set. All tables are generated by default
      --warehouses int   number of repositories (default 10)
```

### Example

1.  Create 4 repositories using 4 partitions with hash

```shell
tiup bench tpcc --warehouses 4 --parts 4 prepare
```

2. Running TPC-C benchmark

```shell
tiup bench tpcc --warehouses 4 run
```

3. Cleanup data

```shell
tiup bench tpcc --warehouses 4 cleanup
```

4. Checking consistency

```shell
tiup bench tpcc --warehouses 4 check
```

5. Generating csv files

```shell
tiup bench tpcc --warehouses 4 prepare --output data
```

6. Generate csv files for specified tables

```shell
tiup bench tpcc --warehouses 4 prepare --output data --tables history,orders
```

7. Turn on pprof

```shell
tiup bench tpcc --warehouses 4 prepare --output data --pprof :10111
```

## TPC-H

The commands and parameters of TPC-C are as follows:

```bash
Available Commands:
  cleanup     cleanup data
  prepare     prepare data
  run         run benchmark

Flags:
      --check            checks the output data, only valid if the scale factor is 1
  -h, --help             tpch help information
      --queries string   All query statements (default "q1,q2,q3,q4,q5,q6,q7,q8,q9,q10,q11,q12,q13,q14,q15,q16,q17,q18,q19,q20,q21,q22")
      --sf int           scale factor
```

## Example

1. Data preparation

```shell
tiup bench tpch --sf=1 prepare
```

2. Benchmarking and checking results

```shell
tiup bench tpch --sf=1 --check=true run
```

3. Benchmarking without checking results

```shell
tiup bench tpch --sf=1 run
```

4. Cleanup

```shell
tiup bench tpch cleanup
```
